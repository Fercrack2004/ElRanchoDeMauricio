<%# app/views/blogs/_blog_actions.html.erb %>

<div class="flex flex-wrap gap-4 items-center">
  <h3 class="text-lg font-semibold text-gray-800 w-full border-b pb-4 mb-4 md:w-auto md:border-b-0 md:pb-0 md:mb-0">Acciones:</h3>
  
  <%# --- Lógica para encontrar la participación del usuario actual --- %>
  <% participation = @blog.blog_participations.find_by(user: current_user) %>

  <%# Botones visibles para casi todos %>
  <%= link_to "Ver Reviews", blog_reviews_path(@blog), class: "flex items-center px-5 py-2.5 bg-white border border-primary-600 text-primary-600 hover:bg-primary-50 rounded-lg font-medium shadow-sm" %>
  <%= link_to "Dejar Review", new_blog_review_path(@blog), class: "flex items-center px-5 py-2.5 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium shadow-md" %>

  <%# --- Botón para ir al Chatroom de Editores --- %>
  <%# AHORA SE MUESTRA SI ERES AUTOR, EDITOR, O ADMIN %>
  <% if @blog.chat_room.present? && (participation&.autor_contribution? || participation&.editor_contribution? || current_user&.admin?) %>
    <%= link_to "Chatroom Editores", blog_chat_room_path(@blog, @blog.chat_room), class: "flex items-center px-5 py-2.5 bg-secondary-600 hover:bg-secondary-700 text-white rounded-lg font-medium shadow-md" %>
  <% end %>
  
  <%# Botón para Editar el Blog %>
  <%# AHORA SE MUESTRA SI ERES AUTOR, EDITOR, O ADMIN %>
  <% if participation&.autor_contribution? || participation&.editor_contribution? || current_user&.admin? %>
    <%= link_to "Editar Blog", edit_blog_path(@blog), class: "flex items-center px-5 py-2.5 bg-yellow-500 hover:bg-yellow-600 text-white rounded-lg font-medium shadow-md" %>
  <% end %>

  <%# Botón para Solicitar Editar %>
  <% if !participation && !current_user&.admin? %>
    <%= link_to "Solicitar Editar", new_blog_request_path(@blog), class: "flex items-center px-5 py-2.5 bg-accent-600 hover:bg-accent-700 text-white rounded-lg font-medium shadow-md" %>
  <% end %>

  <%# Botón para Eliminar el Blog (SOLO ADMIN) %>
  <% if current_user&.admin? %>
    <%= button_to "Eliminar Blog", blog_path(@blog), 
        method: :delete, 
        form: { data: { turbo_confirm: "¿Estás seguro de que quieres eliminar este blog?" } },
        class: "flex items-center px-5 py-2.5 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium shadow-md" %>
  <% end %>
</div>